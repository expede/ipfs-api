{-# OPTIONS_GHC -fno-warn-incomplete-uni-patterns #-}

module Main (main) where

import           RIO
import qualified RIO.ByteString.Lazy                   as Lazy

import           Servant.API
import           Servant.Client.Core.ClientError

import qualified Fission.Internal.UTF8                 as UTF8

import qualified Fission.Web.Auth.Token.Bearer.Types   as Bearer
import           Fission.Web.Auth.Token.JWT.Types      as JWT
import           Fission.Web.Auth.Token.JWT.Validation

import           Fission.Web.Auth.Token.JWT.Resolver   as Proof

import           Test.Tasty.Bench

main :: IO ()
main =
  defaultMain
    [ bgroup "Textable.encode" encode
    , signatureValidation
    ]

signatureValidation :: Benchmark
signatureValidation =
  bgroup "JWT signature Validation"
    [ bgroup "Validate 2048-bit RSA Signature" validateRSA2048Signature
    , bgroup "RSA-based UCAN checks"           validateRSA2048UCAN
    ]

validateRSA2048UCAN :: [Benchmark]
validateRSA2048UCAN =
  [ bench "One   Level"  $ whnf (pureChecks smallRSAContent)  smallRSAUCAN
  , bench "Two   Levels" $ whnf (pureChecks mediumRSAContent) mediumRSAUCAN
  , bench "Three Levels" $ whnf (pureChecks largeRSAContent)  largeRSAUCAN
  ]

validateRSA2048Signature :: [Benchmark]
validateRSA2048Signature =
    [ bench "One level"    $ whnf (runNoResolver . check' smallRSAContent  smallRSAUCAN)  inBounds
    , bench "Two levels"   $ whnf (runNoResolver . check' mediumRSAContent mediumRSAUCAN) inBounds
    , bench "Three levels" $ whnf (runNoResolver . check' largeRSAContent  largeRSAUCAN)  inBounds
    ]
      where
        JWT {claims = JWT.Claims {exp = inBounds}} = largeRSAUCAN

encode :: [Benchmark]
encode =
  [ bench "Strict ByteString" $ nf UTF8.encode ("hello world" :: ByteString)
  , bench "Lazy ByteString"   $ nf UTF8.encode ("hello world" :: Lazy.ByteString)
  ]

smallRSAContent :: RawContent
smallRSAUCAN    :: JWT
Right (Bearer.Token smallRSAUCAN smallRSAContent) = parseUrlPiece "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInVhdiI6IjEuMC4wIn0.eyJhdWQiOiJkaWQ6a2V5OnoxM1YzU29nMllhVUtoZEdDbWd4OVVadVcxbzFTaEZKWWM2RHZHWWU3TlR0Njg5Tm9MMnNWdVFQQUpRbnFIOEVidG1zQXR5dFJmbkRrTHdnS3dnaGdHUEZKamFHV1F3V29RamhWQ3U2VnlpQ0g5YUJKWk5WWFlFTW5LTXFmMW5MVFVqS0dueGlCamMyTVJiVzVtWHEyRXBucGRXUThjUUVYeXdrYWlNQzVTNTNHMmVYNnRadmFtM1J5U3BRaFI3dFN0cWFCRmU4TE1nRFQ5ZVJ2UHlzUnhXY2NScEJRZ0RtenF2NEhKakdyZWZXbktHa0JMU2JRbVlzQk1kODhaY3MybXVEa25ockxwNndoU3NxUDE1em9OZ1RhcUpVRHRhREI4Z296NTVnVmdiOVpIaGVueVFCVFRGV2JjWVRvcWlEbVhMam5mS0tyWmd6S24zMW1NNDNEOEh6aFJyaG5VZkVHbWtZY3dyZkdzWFhxdFRYa1R3TnMxUEFzZmtWcjJTcXg1Q3RVd1ZweDlNZHRKUjFzY2h0N1FVIiwiZXhwIjozMjcxMjcyNDgxMiwiZmN0IjpbXSwiaXNzIjoiZGlkOmtleTp6MTNWM1NvZzJZYVVLaGRHQ21neDlVWnVXMW8xU2hGSlljNkR2R1llN05UdDY4OU5vTDJZcDk1aXV2c0NHTVp6WlRlUFpQRzFpVVJNeWZpR3E5WVlHNEZLYWt6dTJ3c3BVb1FHcHZwSmdxRjg2RFBFMVBjSjFWcENSNUR4Nk1MRk5Fc2I5RWJhWkp1SGtOSGU4Z0RNeDJNYW1NTHM4U05vYkFrVEc5dUVNaWJ5Rm9hUFBjdGJxRWRlRWdyQnJRTURvYWhwSHRMTllHOVhyM01iUUpuNjRLNmdNSDcyZkg2cUQyMlBmSmljN3RBZlRGWFhyV3hud2twYWNwU0g5aTd4U3E1eGhCeGE4a3RNc0tXdk1zWFUxUFkxTUJMZnFlVnkyMUhlZVV4OHZOV3RqRlFjVmtzczRXTGlDY2k4enVMUTdCb2JaMTE2UWpKbUhNTGNVOUVMNXEyclRVbmhBRWg4OUpUU3VjSzhGanRvZnR2eXhWTVF6R3BiYVRrdThKRHhLdTJtS3NOb05IejdxUktiQVlIQVo3VyIsIm5iZiI6MTYwODcyNDc1MiwicHRjIjoiQVBQRU5EIiwicnNjIjoiKiJ9.ebkpn5KMKN3EgUnFrKVDj7SDpO6XbPu6QYePH0zIKM5sRr5XYIsDW1FSMKw9uO5ofvmQM_6vBDpPamcyR6BK73jPi47V_MISy8ENEVvpELXBsu4bpqRFbpoXzl0-XT6AVUy3eB-RCKxDZJRhvbnY8Wmg-D7jVZbYXa8_KjDVq6tA6MFqk46RLmvwopIo_EvJ4S41c8xCm31FjXnpklfjMxfGLPxKhCuaLC0qCiu44_XU7larw8ygsRlj4qJdgBQqqqmEfc-IXcb1YO2p5ToogDjhAvGfnITFGWslfNV6wQKxmGgmMjcFPuQ-CQ8wzypkw1c1BV3yOiJEdhDbFx1jUg"

mediumRSAContent :: RawContent
mediumRSAUCAN    :: JWT
Right (Bearer.Token mediumRSAUCAN mediumRSAContent) = parseUrlPiece "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInVhdiI6IjEuMC4wIn0.eyJhdWQiOiJkaWQ6a2V5OnoxM1YzU29nMllhVUtoZEdDbWd4OVVadVcxbzFTaEZKWWM2RHZHWWU3TlR0Njg5Tm9MMm93enFrUmlpWHFKeGcyelJtdWE1TWlLOXkzNmpGSlBFZ1ZEUm1jb01YczQ1dmF6aUZTNXh3d043ZW55WWJBTkVwY0dQc21rUUc1cjNLaU5IclVjUE5wVndmNFhoTW44UmNWTWV6b0t6RUxYQ3FraFFvN1dWYzZXR2dEYTZuRkx6aXBtZmhYVFFEaEZDeU1TNnRGU2VQZU1wYzdDUTJFNkVkUkE2UTZIdmhqVVRjRDQyS1dUZ0ttVXRXcDJMYWhMTm00bzlGdXhqQmFibmlvaFp1N0Z0eTRmY2t2NlZNYWZHNGdVeVlxdGVnWm1waXBNZEpWN2VoZTJlQXQ3QlZVcmJTYkVxNmdWdlM5TVV1cTM5ZTJUTjJUOTh1dm1UTHZQRHh3ZkJMcDJkRll3Tm90dUV0RFB5QVVNYlllVFlSSEpqdDRaRjlvUkFDUEtKOWNmQzhZM3hxRDI4eXJFUGRvaDZzU0o0IiwiZXhwIjozMjcxMjcyNDgxMiwiZmN0IjpbXSwiaXNzIjoiZGlkOmtleTp6MTNWM1NvZzJZYVVLaGRHQ21neDlVWnVXMW8xU2hGSlljNkR2R1llN05UdDY4OU5vTDJzVnVRUEFKUW5xSDhFYnRtc0F0eXRSZm5Ea0x3Z0t3Z2hnR1BGSmphR1dRd1dvUWpoVkN1NlZ5aUNIOWFCSlpOVlhZRU1uS01xZjFuTFRVaktHbnhpQmpjMk1SYlc1bVhxMkVwbnBkV1E4Y1FFWHl3a2FpTUM1UzUzRzJlWDZ0WnZhbTNSeVNwUWhSN3RTdHFhQkZlOExNZ0RUOWVSdlB5c1J4V2NjUnBCUWdEbXpxdjRISmpHcmVmV25LR2tCTFNiUW1Zc0JNZDg4WmNzMm11RGtuaHJMcDZ3aFNzcVAxNXpvTmdUYXFKVUR0YURCOGdvejU1Z1ZnYjlaSGhlbnlRQlRURldiY1lUb3FpRG1YTGpuZktLclpnektuMzFtTTQzRDhIemhScmhuVWZFR21rWWN3cmZHc1hYcXRUWGtUd05zMVBBc2ZrVnIyU3F4NUN0VXdWcHg5TWR0SlIxc2NodDdRVSIsIm5iZiI6MTYxMDU4NjcxNCwicHJmIjoiZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0lzSW5WaGRpSTZJakV1TUM0d0luMC5leUpoZFdRaU9pSmthV1E2YTJWNU9ub3hNMVl6VTI5bk1sbGhWVXRvWkVkRGJXZDRPVlZhZFZjeGJ6RlRhRVpLV1dNMlJIWkhXV1UzVGxSME5qZzVUbTlNTW5OV2RWRlFRVXBSYm5GSU9FVmlkRzF6UVhSNWRGSm1ia1JyVEhkblMzZG5hR2RIVUVaS2FtRkhWMUYzVjI5UmFtaFdRM1UyVm5scFEwZzVZVUpLV2s1V1dGbEZUVzVMVFhGbU1XNU1WRlZxUzBkdWVHbENhbU15VFZKaVZ6VnRXSEV5UlhCdWNHUlhVVGhqVVVWWWVYZHJZV2xOUXpWVE5UTkhNbVZZTm5SYWRtRnRNMUo1VTNCUmFGSTNkRk4wY1dGQ1JtVTRURTFuUkZRNVpWSjJVSGx6VW5oWFkyTlNjRUpSWjBSdGVuRjJORWhLYWtkeVpXWlhia3RIYTBKTVUySlJiVmx6UWsxa09EaGFZM015YlhWRWEyNW9ja3h3Tm5kb1UzTnhVREUxZW05T1oxUmhjVXBWUkhSaFJFSTRaMjk2TlRWblZtZGlPVnBJYUdWdWVWRkNWRlJHVjJKaldWUnZjV2xFYlZoTWFtNW1TMHR5V21kNlMyNHpNVzFOTkRORU9FaDZhRkp5YUc1VlprVkhiV3RaWTNkeVprZHpXRmh4ZEZSWWExUjNUbk14VUVGelptdFdjakpUY1hnMVEzUlZkMVp3ZURsTlpIUktVakZ6WTJoME4xRlZJaXdpWlhod0lqb3pNamN4TWpjeU5EZ3hNaXdpWm1OMElqcGJYU3dpYVhOeklqb2laR2xrT210bGVUcDZNVE5XTTFOdlp6SlpZVlZMYUdSSFEyMW5lRGxWV25WWE1XOHhVMmhHU2xsak5rUjJSMWxsTjA1VWREWTRPVTV2VERKWmNEazFhWFYyYzBOSFRWcDZXbFJsVUZwUVJ6RnBWVkpOZVdacFIzRTVXVmxITkVaTFlXdDZkVEozYzNCVmIxRkhjSFp3U21keFJqZzJSRkJGTVZCalNqRldjRU5TTlVSNE5rMU1SazVGYzJJNVJXSmhXa3AxU0d0T1NHVTRaMFJOZURKTllXMU5USE00VTA1dllrRnJWRWM1ZFVWTmFXSjVSbTloVUZCamRHSnhSV1JsUldkeVFuSlJUVVJ2WVdod1NIUk1UbGxIT1ZoeU0wMWlVVXB1TmpSTE5tZE5TRGN5WmtnMmNVUXlNbEJtU21sak4zUkJabFJHV0ZoeVYzaHVkMnR3WVdOd1UwZzVhVGQ0VTNFMWVHaENlR0U0YTNSTmMwdFhkazF6V0ZVeFVGa3hUVUpNWm5GbFZua3lNVWhsWlZWNE9IWk9WM1JxUmxGalZtdHpjelJYVEdsRFkyazRlblZNVVRkQ2IySmFNVEUyVVdwS2JVaE5UR05WT1VWTU5YRXljbFJWYm1oQlJXZzRPVXBVVTNWalN6aEdhblJ2Wm5SMmVYaFdUVkY2UjNCaVlWUnJkVGhLUkhoTGRUSnRTM05PYjA1SWVqZHhVa3RpUVZsSVFWbzNWeUlzSW01aVppSTZNVFl3T0RjeU5EYzFNaXdpY0hSaklqb2lRVkJRUlU1RUlpd2ljbk5qSWpvaUtpSjkuZWJrcG41S01LTjNFZ1VuRnJLVkRqN1NEcE82WGJQdTZRWWVQSDB6SUtNNXNScjVYWUlzRFcxRlNNS3c5dU81b2Z2bVFNXzZ2QkRwUGFtY3lSNkJLNzNqUGk0N1ZfTUlTeThFTkVWdnBFTFhCc3U0YnBxUkZicG9YemwwLVhUNkFWVXkzZUItUkNLeERaSlJodmJuWThXbWctRDdqVlpiWVhhOF9LakRWcTZ0QTZNRnFrNDZSTG12d29wSW9fRXZKNFM0MWM4eENtMzFGalhucGtsZmpNeGZHTFB4S2hDdWFMQzBxQ2l1NDRfWFU3bGFydzh5Z3NSbGo0cUpkZ0JRcXFxbUVmYy1JWGNiMVlPMnA1VG9vZ0RqaEF2R2ZuSVRGR1dzbGZOVjZ3UUt4bUdnbU1qY0ZQdVEtQ1E4d3p5cGt3MWMxQlYzeU9pSkVkaERiRngxalVnIiwicHRjIjoiQVBQRU5EIiwicnNjIjoiKiJ9.NRFNCmOtlfwH-Xv57ZZpFQD37SG7-7su_DxxWzz4M1pmkE9T1J1IoBpsYynIEOuyYkosP91MAhVcjeNi4_OO4-XoVmzeGqnSusUGmARf8YcemfKWLeYPuOOhLc2I7wgRpPj-dGUYSFH_kVYKpeP3HPvV_57WRVoyYCqW3LwWbB3RdKIPxuqx09EIeGjjIk3b-pNAhBTrrRLCtd8UNeO2MF9csrW-ThKaRS71wzJc-yYoSM54uhOiidkvsk-f23LQ8ISr9JiHRp2ReaL4SZ6zN3a3ottWCkjT3lAZM6gvI_qcLeVsO5swwLxXP9gzERUR3tHR_D9JWn7X1cOVYuGyEA"

largeRSAContent :: RawContent
largeRSAUCAN    :: JWT
Right (Bearer.Token largeRSAUCAN largeRSAContent) = parseUrlPiece "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInVhdiI6IjEuMC4wIn0.eyJhdWQiOiJkaWQ6a2V5OnpTdEVacHpTTXRUdDlrMnZzemd2Q3dGNGZMUVFTeUExNVc1QVE0ejNBUjZCeDRlRko1Y3JKRmJ1R3hLbWJtYTQiLCJleHAiOjE2MTgxNjYzNTMsImZjdCI6W10sImlzcyI6ImRpZDprZXk6ejEzVjNTb2cyWWFVS2hkR0NtZ3g5VVp1VzFvMVNoRkpZYzZEdkdZZTdOVHQ2ODlOb0wzNld5RlA3VlBWUW9wOEhLdkFoZjFaTEtCMTE0dThKM3AzTXd2UGhCQzNMbmppV0hwd3pvdzlLdkhYVHRiaEw1dmoxQ0JXc1dvYzdaU05vamlxTWo1QUNQR05jdTI2MVM2RDZpYm9VWWh0WmhiV0hTZVVwWTJod0ZrekdzZ1kxakc2WEdra0drdDlnOWdqdXhkdVhBaEdaeXA1d2ZIQ3hwZ3cyTVhmWGlMamJwOUJyN1lyQ0t1TWlycFhnb1p4V2FHQnluTFdXWDNWckdYd1VVaWhnUHFlV3R1UmhuUm5UTVg1a3FYUnJBR0NKOGd6dHlQTllGaTZKc2VqdXVhcmdxTEJWOFI4R29IUkdXZjdIZG9ORmRlN0FvbU1SR0RrZHFnVURFb0VONnBTdTZyY0RwTUhvand0OWNiTEQzcW9zdktGRmhrU25wUDlSMnBMZTVUaWl3MUpCRVZVeUtQWDVSMkZaRk4iLCJuYmYiOjE2MTgxNjYyNjMsInByZiI6ImV5SmhiR2NpT2lKU1V6STFOaUlzSW5SNWNDSTZJa3BYVkNJc0luVmhkaUk2SWpFdU1DNHdJbjAuZXlKaGRXUWlPaUprYVdRNmEyVjVPbm94TTFZelUyOW5NbGxoVlV0b1pFZERiV2Q0T1ZWYWRWY3hiekZUYUVaS1dXTTJSSFpIV1dVM1RsUjBOamc1VG05TU16WlhlVVpRTjFaUVZsRnZjRGhJUzNaQmFHWXhXa3hMUWpFeE5IVTRTak53TTAxM2RsQm9Ra016VEc1cWFWZEljSGQ2YjNjNVMzWklXRlIwWW1oTU5YWnFNVU5DVjNOWGIyTTNXbE5PYjJwcGNVMXFOVUZEVUVkT1kzVXlOakZUTmtRMmFXSnZWVmxvZEZwb1lsZElVMlZWY0ZreWFIZEdhM3BIYzJkWk1XcEhObGhIYTJ0SGEzUTVaemxuYW5WNFpIVllRV2hIV25sd05YZG1TRU40Y0dkM01rMVlabGhwVEdwaWNEbENjamRaY2tOTGRVMXBjbkJZWjI5YWVGZGhSMEo1Ymt4WFYxZ3pWbkpIV0hkVlZXbG9aMUJ4WlZkMGRWSm9ibEp1VkUxWU5XdHhXRkp5UVVkRFNqaG5lblI1VUU1WlJtazJTbk5sYW5WMVlYSm5jVXhDVmpoU09FZHZTRkpIVjJZM1NHUnZUa1prWlRkQmIyMU5Va2RFYTJSeFoxVkVSVzlGVGpad1UzVTJjbU5FY0UxSWIycDNkRGxqWWt4RU0zRnZjM1pMUmtab2ExTnVjRkE1VWpKd1RHVTFWR2xwZHpGS1FrVldWWGxMVUZnMVVqSkdXa1pPSWl3aVpYaHdJam94TmpFNU16VTBOelF6TENKbVkzUWlPbHRkTENKcGMzTWlPaUprYVdRNmEyVjVPbm94TTFZelUyOW5NbGxoVlV0b1pFZERiV2Q0T1ZWYWRWY3hiekZUYUVaS1dXTTJSSFpIV1dVM1RsUjBOamc1VG05TU1tOTNlbkZyVW1scFdIRktlR2N5ZWxKdGRXRTFUV2xMT1hrek5tcEdTbEJGWjFaRVVtMWpiMDFZY3pRMWRtRjZhVVpUTlhoM2QwNDNaVzU1V1dKQlRrVndZMGRRYzIxclVVYzFjak5MYVU1SWNsVmpVRTV3Vm5kbU5GaG9UVzQ0VW1OV1RXVjZiMHQ2UlV4WVEzRnJhRkZ2TjFkV1l6WlhSMmRFWVRadVJreDZhWEJ0Wm1oWVZGRkVhRVpEZVUxVE5uUkdVMlZRWlUxd1l6ZERVVEpGTmtWa1VrRTJVVFpJZG1ocVZWUmpSRFF5UzFkVVowdHRWWFJYY0RKTVlXaE1UbTAwYnpsR2RYaHFRbUZpYm1sdmFGcDFOMFowZVRSbVkydDJObFpOWVdaSE5HZFZlVmx4ZEdWbldtMXdhWEJOWkVwV04yVm9aVEpsUVhRM1FsWlZjbUpUWWtWeE5tZFdkbE01VFZWMWNUTTVaVEpVVGpKVU9UaDFkbTFVVEhaUVJIaDNaa0pNY0RKa1JsbDNUbTkwZFVWMFJGQjVRVlZOWWxsbFZGbFNTRXBxZERSYVJqbHZVa0ZEVUV0S09XTm1RemhaTTNoeFJESTRlWEpGVUdSdmFEWnpVMG8wSWl3aWJtSm1Jam94TmpFMk56WXlOamd6TENKd2NtWWlPaUpsZVVwb1lrZGphVTlwU2xOVmVra3hUbWxKYzBsdVVqVmpRMGsyU1d0d1dGWkRTWE5KYmxab1pHbEpOa2xxUlhWTlF6UjNTVzR3TG1WNVNtaGtWMUZwVDJsS2EyRlhVVFpoTWxZMVQyNXZlRTB4V1hwVk1qbHVUV3hzYUZaVmRHOWFSV1JFWWxka05FOVdWbUZrVm1ONFlucEdWR0ZGV2t0WFYwMHlVa2hhU0ZkWFZUTlViRkl3VG1wbk5WUnRPVTFOYlRrelpXNUdjbFZ0YkhCWFNFWkxaVWRqZVdWc1NuUmtWMFV4VkZkc1RFOVlhM3BPYlhCSFUyeENSbG94V2tWVmJURnFZakF4V1dONlVURmtiVVkyWVZWYVZFNVlhRE5rTURReldsYzFOVmRYU2tKVWExWjNXVEJrVVdNeU1YSlZWV014WTJwT1RHRlZOVWxqYkZacVZVVTFkMVp1WkcxT1JtaHZWRmMwTkZWdFRsZFVWMVkyWWpCME5sSlZlRmxSTTBaeVlVWkdkazR4WkZkWmVscFlVakprUlZsVVduVlNhM2cyWVZoQ2RGcHRhRmxXUmtaRllVVmFSR1ZWTVZST2JsSkhWVEpXVVZwVk1YZFplbVJFVlZSS1JrNXJWbXRWYTBVeVZWUmFTV1J0YUhGV1ZsSnFVa1JSZVZNeFpGVmFNSFIwVmxoU1dHTkVTazFaVjJoTlZHMHdNR0o2YkVka1dHaHhVVzFHYVdKdGJIWmhSbkF4VGpCYU1HVlVVbTFaTW5ReVRteGFUbGxYV2toT1IyUldaVlpzZUdSSFZtNVhiVEYzWVZoQ1RscEZjRmRPTWxadldsUktiRkZZVVROUmJGcFdZMjFLVkZsclZuaE9iV1JYWkd4Tk5WUldWakZqVkUwMVdsUktWVlJxU2xWUFZHZ3haRzB4VlZSSVdsRlNTR2d6V210S1RXTkVTbXRTYkd3elZHMDVNR1JWVmpCU1JrSTFVVlpXVGxsc2JHeFdSbXhUVTBWd2NXUkVVbUZTYW14MlZXdEdSRlZGZEV0UFYwNXRVWHBvV2swemFIaFNSRWswWlZoS1JsVkhVblpoUkZwNlZUQnZNRWxwZDJsYVdHaDNTV3B2ZWsxcVkzaE5hbU41VGtSbmVFMXBkMmxhYlU0d1NXcHdZbGhUZDJsaFdFNTZTV3B2YVZwSGJHdFBiWFJzWlZSd05rMVVUbGROTVU1MlducEtXbGxXVmt4aFIxSklVVEl4Ym1WRWJGWlhibFpZVFZjNGVGVXlhRWRUYkd4cVRtdFNNbEl4Ykd4T01EVlZaRVJaTkU5Vk5YWlVSRXA2Vm01V1VsVkZSa3RWVnpWNFUwUm9SbGx1VW5Sak1FWXdaVmhTVTFwdE5VVmhNSGd6V2pCME0xb3lhRzVTTVVKSFUyMXdhRkl4WkZKa01XUjJWVmR3YjFaclRqRk9iRm8xWVZWT1NVOVhSa05UYkhCUFZteG9XbEpWTVhWVE1ERjRXbXBHZFZSR1VsWmhhM1JJWW01b2NGRnRjR3BOYXpGVFdXeGpNV0pXYUhoTmExWjNZbTVDYTFZeFJUUlpNVVpHVjBoc00yRXlSbkJVVlUweFZYcFZlbEo2U214WFJGb3dWMjVhYUdKVVRsTmxWazUzVlZkb1UwNHpVbFJrU0Vab1VXdGFiRTlGZUU1YU1GSlZUMWRXVTJSc1FqVmpNVW8wVmpKT2FsVnVRa05WVjJSRllsaHdlR1JxVWtsVGJYQklZMjFXYlZZeU5VeFNNblJEVkVaT2FWVlhNVnBqTUVwT1drUm5ORmR0VG5wTmJURXhVa2QwZFdGSVNrMWpSRm96WVVaT2VtTldRWGhPV0hCMlZHMWtWVmxZUmt0V1ZWSXdXVlZTUTA5SFpIWmxhbFV4V2pGYWJsbHFiR0ZUUjJoc1ltNXNVbEZzVWxWU2JHUnBXVEZzVldJelJuQlNSekZaVkVkd2RWcHJkRXhqYkhCdVpXdDBkVTE2Um5SVVZGRjZVa1JvU1dWdGFGTmpiV2gxVmxkYVJsSXlNWEpYVjA0elkyMWFTR014YUZsaldGSlZWMGQwVldRd05YcE5Wa0pDWXpKYWNsWnVTWGxWTTBZMFRsVk9NRlpZWkZkalNHYzFWRmRTTUZOc1NYaGpNazV2WkVSa1VsWlRTWE5KYlRWcFdtbEpOazFVV1hoTlJGVTBUbXBqZUU1RGQybGpTRXB0U1dwdmFWcFliRXRoUjBwSVdUSnNVR0ZWY0ZSV1dIQktUVlUxY0ZOWVRrcGliRWt4V1RCT1NrNXJiSEpqUm1oWFVUQnNlbE5YTlZkaFIxSndVMVJhU21GclZqRlVWVTB3WkRCc2RVMUROV3hsVlhCdldrWmtVbUZWT1hCVGJYUm9WakZGTWxsVVNsZE9WVGwxWWpOb1RrMVdiRFpXVkVrMVltc3hjMkpIYUZkV1dGSjJWMnRXYTFKSFNsaGFSRkpRVm14YWFGcEdXbXBsUjBvMlVteFNhRkpXY0V4V01XUk9UV3hLU1ZkcmFGaFdNVlY2VmtkNFUwMUZOWEZhZWxaVllsUnNUbFJYTlU5V01sSlhVbXhHVWxaWVFsTlpiVFZIVTFVNVJsWnRiR3RTZWtZMlZWWm9VMDVYVWtkVGJURnBZVEZLZVZaRmFHdGliRTE2V2tjMWFGSXlVa2xXVlZaaFV6SkdkRkpyYUZkTlZWbDZWbXBKTlZWdFJuUmhSbVJTVFRGVmVWWnROWE5qUmtWM1ducFdXbFpWY0V4V01uTXhWakZrUjJKRldsVldlbFpOVmtab1IySlZNVmhPVlRGWFVteGFlRlY2UW10a1YxWklZa1ZPYUdKVk1UVldSbHBMWVZaYU5sWnVVbGhUUlZZMVZXeG9RMlJYVGtoVmJHaFdWa2RvY1ZaV1ZsZFhWMVpaV2toS1dsWXllRTlWV0hCWFZrVTFWVlJyYUU1aVZscGFWRzAxVTFsWFVuUlNibEpPVFZWdk1WWlVUa05WYlVaSFUxUk9hMUpyTkhkWk1XUkhVVEZLZEZaVVVsVlNWRVoxVld0YVVrNVdjRmRUYWtwV1UwZDRObFpYTlc5WFJtdDVWR3hPYWxKVmNGTlhha0pUWkVkV2RWSnFTazlTVjJoTVdWZDBhMlZXY0ZoWGJHaHBZVE5TU1ZsVVFrdFVWbFY1VTJ4S2FWWnRlRFpWVjNONFlUQTVSV0ZIUmxwTk1ERTFXV3hvVjFKWFJYbE9WemxxWVROb00xUnROV3RpTVZWNlZHNW9WbEpGVlhoYVZ6QTFWREZ2ZUZWdGFHcFdXRUpYVld0b1UyRkdTa1pUVkZKaFRXcHJNbFJzVWxkaWJGcDBXa2RzVUZadVFrcFpWV1JYWkZkV1YxSnJUbGRTYkVwSVZtcEtTMkZzWkZkVmJscHFWako0Umxsc1dtOVVWMFowVGxjeFZFMUlValZXTWpGclRteE5lVTVJY0U1V2VrWlBWR3RTVDFKVk9VWmhSRnBvVW10d05WbFZZekZXYkhCeVZtdG9hVll6VW1GWFZFNXJaVlp3Y2xwSWNGaFNiV2cwV2tWYVUxZFhSWGhWYWs1Vlltc3hORlpWVmtkbGJIQjBaRVprYW1GcmNGVlpNV2h1VFZaRmVsVnNXbXROVm5BeldsVlNjMVJzY0VsVmEzUldZV3RhTmxkVVNtOU5SVFI0VW14YVNtRllaSEJYYkdodlpEQnNjV0l6Y0U1aGJVNDBWRmR3YW1WVk5VVmFNMmhPWVZoa2NGZHRNVTlOUld4eFkwZEtXVlV6WkhCWlZtaFBaV3RzY1dJeWJHRlNNbmh5VkRJeE1HSkhWbFZqUkZwT1ZrVTFXRlJVUms5a2JIQTJVMnh3V2xac1drMVpWV1JUVTBaRmVVMVhOV3hTUjNoWFZqSTFWMWRGTVZoUFNHaFdUVzFvU0ZVeWVITmhhelZ5VldwS1UwMVhlSE5VYWtFeFZsZFNSVmRVVWxCV1ZGWXlWa1ZTUzFkdFRrVmhla1pvVjBaWmVWbDZRazlUUmxKWFkwUmFXR0pHU25OV1ZWcDNWVlpLTmxKdVFsZFdhM0JQV2xaa1lXTkdTWHBTVkZaWVZtMTRTVlJyVm1GVVJteFlaRVJhYTFaRmIzcFplazVEVm0xSmVGSnJhR3BUUm5BelZUSXhhMlZHU25GYWVrcFRVbXRLUjFSV1drTmhiRTV4VW14a2FsSlZOVlJVYkZaVFRrVTFjazFWTVZOaGVsWkhXWHBLU2s1V1NsaFRiV2hZWVROQmVGVXdaREJVTVU1SVZsUlNZVTFHU2s5YVZWSkxWR3hzV0UxVk5WVlRSVEF3VmxSQk1XUnNiSEpTYmtwWFVsZE5NVnBHVmxkVWJVWllVMnBXVTJKVWJHOVdWVnBEWVcxU1NGTnVhRk5XTVVwelZXeGthMlZXUm5WVGJFcFZWbFpLTWxkV1pHOWtNVTVKVldzeFZXSkhlRWxVTVZwdlpWVXdkMDFYYkZaV1dFSXhWRzF3VTFSRk5YUmFSVFZVVWtkT05WZHRkRzVOYlU1V1ZWaHNUbUpGU25SVk1qRnpZV3MwZWxWclNtRmlSa3BJVmpCYWIyVldXWHBoU0ZaclRXNVNNMWRXWkU5a01WVjNXbnBXYUZaSFVUQldWRTVHVFZkV1NHRkZUbXhTTUZVd1dWUk9VMVJ0VFhka1JtaHJZWHBHTmxZd1dsWmxSbFpIWVROb1ZWWlZjRTVYYlRWSFlrWmFkV0V6YkU1V1YyaHpWMnhhVjA1Rk9VbFhhemxYVFRGS2VGVnRlRWRoYkZwMFpFaHdhbVZzU2xsV1JXUnpVa1pyZVdGNlVteGliRnBPVmxaU2ExRXlTWGxUYlVaT1ZrVlZlVlpXWkhkVE1rcFdZVVUxVlZJd05WZFVNVlpYVkZVMVdWSlliR3BpUmtwWFdXMHhiMUZzU2xoYWVsSlFWbGhDVmxaVVRsZGhiRTQyWVVWa2FHSnNTakpYYlRWVFRXMVdXV0ZHWkZWV2Exa3lWV3BPUTJGV2JGZFZia3ByVmtkb1RGVnJhRzlVUjFKVlUyNVNWRTB3TlZCWmFrRXhVMWRXY1ZwSWFGWmhNMUp3VlZaYWMxTldSbGRpZWs1WFpWVnNlbE5YTURGaFZuQndVMVJhVGxaR2JETlVNRkpxWlZVMVJWbDZSazVoV0dSd1dUQm9VMkZyYkhGaU1teFNWbXRLVWxWc1ZURlNWV3h3WkRKc2FtSnJOWEZUVjNCMllWVjBjRk5xYTNWYVYwcHlZMGMwTVZNd01VeFVhazVHV2pGV2RWSnVTa3hXYTFKeFRqRk9SV05GT0RKWFIwcFJaRlJhVWxkWFZsRlRSRUkyVTFWMFRrNVlUbE5qYWxaWlYxVnNlbEpHWTNoU2JFNU9Vek5qTldSVk9ERmlNbG95WWxaR1RsaDZXakpSYTFKM1ZVZEdkRmt6YkZOT2EwcE1UbnBPY1ZWSGF6Qk9NVnBtVkZWc1ZHVlVhRVpVYTFaWFpHNUNSbFJHYUVOak0xVXdXVzVDZUZWcldtbGpSemxaWlcxM2QweFdhRlZPYTBaWFZsaHJlbHBWU1hSVmEwNU1aVVZTWVZOc1NtOWtiVXAxVjFSb1dHSlhZM1JTUkdSeFZteHdhVmRXYUdoUFJqbE1ZV3RTVjJOVVdqQlJWRnBPVW01R2NrNUVXbE5VUnpFeVpESTVkMU5YT1daU1dGcExUa1pOTUUxWFRUUmxSVTUwVFhwR1IyRnNhSFZqUjNSeldtMXdUbVZIV2toVVJrSTBVekpvUkdSWFJrMVJla0o0VVRKc01VNUVVbVpYUmxVellrZEdlV1I2YURWYU0wNVRZa2R2TUdOVmNHdGFNRXBTWTFoR2VHSlZWbTFaZVRGS1YwZE9hVTFXYkZCTmJrRXhWa2M1ZGxvd1VuRmhSVVl5VWpKYWRWTldVa2RTTVdSNllrZGFUMVpxV2pOVlZYUTBZbFZrYm1KVk1YRlpNRnBSWkZaRmRGRXhSVFJrTTNBMVkwZDBNMDFYVFhoUmJGbDZaVlU1Y0ZOclZtdGhSVkpwVW01bmVHRnNWbTVKYVhkcFkwaFNha2xxYjJsUlZrSlJVbFUxUlVscGQybGpiazVxU1dwdmFVdHBTamt1VGxKR1RrTnRUM1JzWm5kSUxWaDJOVGRhV25CR1VVUXpOMU5ITnkwM2MzVmZSSGg0VjNwNk5FMHhjRzFyUlRsVU1Vb3hTVzlDY0hOWmVXNUpSVTkxZVZscmIzTlFPVEZOUVdoV1kycGxUbWswWDA5UE5DMVliMVp0ZW1WSGNXNVRkWE5WUjIxQlVtWTRXV05sYldaTFYweGxXVkIxVDA5b1RHTXlTVGQzWjFKd1VHb3RaRWRWV1ZOR1NGOXJWbGxMY0dWUU0waFFkbFpmTlRkWFVsWnZlVmxEY1ZjelRIZFhZa0l6VW1STFNWQjRkWEY0TURsRlNXVkhhbXBKYXpOaUxYQk9RV2hDVkhKeVVreERkR1E0VlU1bFR6Sk5SamxqYzNKWExWUm9TMkZTVXpjeGQzcEtZeTE1V1c5VFRUVTBkV2hQYVdsa2EzWnpheTFtTWpOTVVUaEpVM0k1U21sSVVuQXlVbVZoVERSVFdqWjZUak5oTTI5MGRGZERhMnBVTTJ4QldrMDJaM1pKWDNGalRHVldjMDgxYzNkM1RIaFlVRGxuZWtWU1ZWSXpkRWhTWDBRNVNsZHVOMWd4WTA5V1dYVkhlVVZCSWl3aWNIUmpJam9pUVZCUVJVNUVJaXdpY25Oaklqb2lLaUo5LlZhZ1FZd3JKT3NjaHMtYUxySDY2SlRMMXpjVjdfSkpBNndDVlNuRmdrLWRDMjZYMUVJb3BIT044YVg2MWl4ZWVpeDQ1czcxWXhqWDZVeXcwYlFoZ1ZwVHpCWjhTblhnOU1OMWt4ODRfODdMbEpzb2RGLWNiekdPREU1VnpvaW1vdlJiWXZvTS0tTTIxcjc3VldhaU45Q1BOTThUaTFadXVIRkk0dExNakRXZ3NvZjJPS2E5T0p3TUx4SUl3VkU5anU5UWFXUVdCanF6Y2xCU3NfLVBzUFJpb3NRd3Z5a2hlZ2RlazU2YndnckFNWUtDdGZ0bThjd2pMR3QzWVYyZHRveGtldzlCa0VQVURLSnJjaGhHcGtidVU1cEh3cTBrNVhaQ3RaeDFyWTk1UVM4MkpLOGk5VkJvUjZiVmlmMG5qNHNUUVFsWlE1YXJmVGlEb3BGWG9hQSIsInB0YyI6IkFQUEVORCIsInJzYyI6IioifQ.gZY8RZvCHrwsqDlVXiH3HOSnDq00smBrYWPcEMQb4oGpixT8dOMXDXbGCC6QrWkc_6L903_Tep0SYYkdRbr2kP4r3O5D72cKkAlEIh2c8TAQ8V5MDyvZ_siXkztuaH5raQlxdx1uyrVz8TWzvHbd88Go51rYNsrc0YJLbANZ9DG0OQcXfwjICmwFn_tIT4EBYTjOgDNter3dR91aDRu57rzQc_wPw9Gh97CCkIAbDs0XegW6RjvYBRSsU1NyQOQRcIy6hGcChC5OZ8Zgq8wvHT39f-OHqkFQMShBe5rzC61c-Kf_NLHMrCDCQHIbWO0IQiVnkUN42PfGequ0WkgSrA"

newtype NoResolver a = NoResolver { runNoResolver :: Identity a }
  deriving newtype
    ( Functor
    , Applicative
    , Monad
    , Eq
    , Show
    )

data MockedReason = MockedReason
  deriving (Show, Eq, Exception)

instance Proof.Resolver NoResolver where
  resolve cid = return . Left $ CannotResolve cid (ConnectionError $ toException MockedReason)
